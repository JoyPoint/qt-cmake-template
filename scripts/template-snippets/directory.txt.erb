<%- Dir.glob(target_directory + '/*/').each do |directory| %>
add_subdirectory(<%= directory[(target_directory.length + 1)..-2] %>)
<%- end %>

include_directories(${CMAKE_CURRENT_SOURCE_DIR}
                    ${CMAKE_CURRENT_BINARY_DIR})

file(GLOB UI_FILES *.ui)
file(GLOB CODE_FILES *.cpp)

qt4_wrap_ui(UI_HEADERS ${UI_FILES})

<% unless library == false %>
<% library_name = directory_library_name(target_directory) %>
add_library(<%= library_name %> STATIC
  ${UI_FILES}
  ${CODE_FILES}
)
if (NOT WIN32)
  set_target_properties(<%= library_name %> PROPERTIES
                        COMPILE_FLAGS -fPIC)
endif (NOT WIN32)
<% end %>
